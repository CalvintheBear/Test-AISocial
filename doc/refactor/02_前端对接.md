# 02｜前端对接改造指南（ClaudeCode 任务）

> 提示词：
> 仅在以下范围改动：`apps/web/**`、`doc/**`、`README.md`。完成每一项改造后运行 `npm --workspace apps/web run build` 验证通过。

---

## 任务 A：用户页改为真实数据源

- 新增后端接口（依赖 01 完成）：`GET /api/users/me` 返回 `{ id, name, email, profile_pic }`。
- 前端 `/user/[username]/page.tsx`：
  - 移除 `mockUser`；
  - 通过 `authFetch('/api/users/me')` 获取当前用户资料与 `id`；
  - 使用真实 `id` 请求：
    - `GET /api/users/:id/artworks` → 渲染“我的作品”（本人=草稿+发布）
    - `GET /api/users/:id/favorites` → 渲染“我的收藏”
- 代码片段（示例）：
```ts
const me = await authFetch('/api/users/me')
const [artworks, favorites] = await Promise.all([
  authFetch(API.userArtworks(me.id)),
  authFetch(API.userFavorites(me.id)),
])
```

---

## 任务 B：操作后刷新策略（SWR）

- 对点赞/收藏/发布后，调用 `mutate` 或重新请求列表：
  - 当前页是用户页：`mutate('user-artworks-${me.id}')` / `mutate('user-favorites-${me.id}')`
  - 当前页是推荐页：主动重新请求 `/api/feed`
- 代码片段：
```ts
import useSWR, { mutate } from 'swr'
// 发布成功：
mutate(`user-artworks-${me.id}`)
mutate('feed')
```

---

## 任务 C：卡片/详情统一使用 thumbUrl 优先

- `ArtworkCard` 与详情页：渲染图片时优先 `thumbUrl || originalUrl`。
- 确认 `useFeed`、`useUserArtworks` 等 hook 解包后字段一致。

---

## 任务 D：错误处理与登录提示

- 对 401 的接口响应：触发 Clerk 登录弹窗（`SignInButton`）或跳转 `/login`。
- 对 500 的接口响应：Toast + 重试按钮（已存在 `ApiErrorBoundary` 可复用）。

---

## 验收
- 登录后：用户页展示真实资料头像、作品与收藏；上传后“我的作品”出现草稿；发布后移除草稿标识；
- 点赞/收藏/取消：当前列表与推荐页可在不刷新页面的情况下更新；
- 构建命令 `npm --workspace apps/web run build` 通过。
