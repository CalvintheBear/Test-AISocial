# 04｜测试与发布（ClaudeCode 任务）

> 提示词：按步骤执行并在每步附带日志/截图。必要时修改 `README.md` 相关段落。

---

## 本地测试
```bash
# 1) 后端
npm --workspace apps/worker-api run dev
# 2) 前端
npm --workspace apps/web run dev
```

### API 健康与鉴权
```bash
curl -i "$API_BASE/api/health"
curl -i "$API_BASE/api/feed"
```

### 上传/发布/点赞/收藏回归
- 使用 Postman/Thunder Client 调用：
  - POST /api/artworks/upload (multipart: file,title)
  - POST /api/artworks/:id/publish
  - POST/DELETE /api/artworks/:id/like
  - POST/DELETE /api/artworks/:id/favorite
- 验证：
  - D1 Studio 中 `artworks.published_at/updated_at` 正确；
  - Redis 计数与集合更新；
  - 前端用户页与 Feed 刷新。

---

## 构建与部署
```bash
# 构建前端
npm --workspace apps/web run build
# 发布后端
npm --workspace apps/worker-api run deploy
```

---

## 故障排查
- `wrangler tail ai-social-api --format pretty`
- Pages 403：检查 `nodejs_compat` 与 `NEXT_PUBLIC_API_BASE_URL`
- Worker 500：检查 D1 迁移是否 `--remote` 应用，或 Redis 未配置是否走内存回退
